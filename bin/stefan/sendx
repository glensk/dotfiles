#!/bin/sh
[ "$1" = "" ] && echo "ERROR: please specify a directory as first argument!" && exit

datum=`date +"%Y_%m_%d__%H:%M:%S"`
filename=".sendx_$datum"
#echo $filename
touch $filename
echo `pwd` > $filename
echo $* >> $filename


##### TAR the file ######################################
#tar --use-compress-program=lbzip2 -cvf archive.tar.bzip2 $filename $*
#tar -cvf archive.tar.bzip2 $filename $*
#[ -e "name-of-archive.tar.gz" ] && rm name-of-archive.tar.gz
#tar -czvf name-of-archive.tar.gz $filename $*
tosend="sendx.tar.bzip2"
rm -f $tosend
tar.bzip2_file_or_folder_for_sendx.sh $*
[ ! -e "$tosend" ] && echo tar did not work out since no $tosend created && exit


####### move to ~/.exchange ############################
address="aglen@gate.rzg.mpg.de"  # garching
address="aglensk@ela.cscs.ch"    # ela, part of daint


echo "scp sendx.tar.bzip2 $address:~/.exchange/"
if [ "`hostname | grep -o daint`" == "daint" ];then
    mv $tosend ~/.exchange/
else
    scp $tosend $address:~/.exchange/
fi


###### remove the rm $tosend archive  ######################
[ -e "$tosend" ] && rm $tosend 


